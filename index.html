<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doğrulanmış Kardiyovasküler Risk Hesaplayıcı | MESA & SCORE2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1976D2; --accent-color: #4CAF50; --accent-light-color: #F1F8E9;
            --text-color: #212121; --secondary-text-color: #757575; --divider-color: #BDBDBD;
            --background-color: #ECEFF1; --negative-color: #D32F2F; --positive-color: #0288D1;
        }
        body {
            font-family: 'Roboto', sans-serif; background-color: var(--background-color); margin: 0; padding: 24px;
            display: flex; justify-content: center; align-items: flex-start; min-height: 100vh;
        }
        .card {
            background-color: #ffffff; border-radius: 8px; box-shadow: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
            max-width: 700px; width: 100%; box-sizing: border-box; overflow: hidden;
        }
        .tab-container { display: flex; background-color: #f5f5f5; }
        .tab-button {
            flex: 1; padding: 16px; border: none; background-color: transparent; font-size: 14px;
            font-weight: 500; color: var(--secondary-text-color); cursor: pointer; transition: all 0.3s;
            border-bottom: 2px solid transparent;
        }
        .tab-button.active { color: var(--primary-color); border-bottom: 2px solid var(--primary-color); }
        .calculator-content { padding: 24px 32px 32px 32px; }
        .hidden { display: none; }
        h1 { color: var(--text-color); text-align: center; margin: 0 0 32px 0; font-weight: 500; font-size: 24px; }

        /* Form Stilleri */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0 24px; }
        .form-group { position: relative; margin-bottom: 24px; }
        .form-group.full-width { grid-column: 1 / -1; }
        .form-input, .form-select { width: 100%; border: none; border-bottom: 1px solid var(--divider-color); padding: 12px 0 8px 0; font-size: 16px; background-color: transparent; position: relative; z-index: 1; }
        .form-select { -webkit-appearance: none; -moz-appearance: none; appearance: none; cursor: pointer; }
        .select-icon { position: absolute; right: 0; top: 12px; pointer-events: none; color: var(--secondary-text-color); z-index: 0; }
        .form-label { position: absolute; top: 12px; left: 0; font-size: 16px; color: var(--secondary-text-color); pointer-events: none; transition: 0.2s ease all; }
        .form-input:focus, .form-select:focus { outline: none; border-bottom-width: 2px; border-bottom-color: var(--primary-color); }
        .form-input:focus ~ .form-label, .form-input:valid ~ .form-label, .form-select:focus ~ .form-label, .form-select:valid ~ .form-label { top: -12px; font-size: 12px; color: var(--primary-color); }
        .radio-group-title { color: var(--secondary-text-color); font-size: 14px; margin-bottom: 12px; }
        .radio-container { display: inline-flex; align-items: center; margin-right: 24px; cursor: pointer; }
        .radio-container input { display: none; }
        .radio-checkmark { height: 20px; width: 20px; border: 2px solid var(--secondary-text-color); border-radius: 50%; display: inline-block; position: relative; margin-right: 8px; }
        .radio-checkmark:after { content: ''; position: absolute; display: none; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 10px; height: 10px; border-radius: 50%; background: var(--primary-color); }
        .radio-container input:checked ~ .radio-checkmark { border-color: var(--primary-color); }
        .radio-container input:checked ~ .radio-checkmark:after { display: block; }
        .radio-label { color: var(--text-color); }

        /* Buton Stilleri */
        .material-button { width: 100%; padding: 12px 24px; background-color: var(--primary-color); color: white; border: none; border-radius: 4px; font-size: 14px; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; cursor: pointer; transition: box-shadow 0.3s; position: relative; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); }
        .material-button:hover { box-shadow: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23); }
        .ripple { position: absolute; border-radius: 50%; transform: scale(0); animation: ripple-animation 0.6s linear; background-color: rgba(255, 255, 255, 0.7); }
        @keyframes ripple-animation { to { transform: scale(4); opacity: 0; } }

        /* Sonuç Alanı Stilleri */
        #sonuc-alani { margin-top: 32px; display: none; }
        .patient-summary { padding: 20px; background-color: #f5f5f5; border-radius: 4px; margin-bottom: 16px; }
        .patient-summary h3 { margin: 0 0 16px 0; font-weight: 500; }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px 16px; font-size: 14px; }
        .summary-item strong { color: var(--text-color); }
        .results-card { padding: 20px; background-color: var(--accent-light-color); border-radius: 4px; border-left: 5px solid var(--accent-color); }
        .results-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
        .results-item { display: flex; align-items: flex-start; }
        .results-item svg { width: 24px; height: 24px; margin-right: 12px; fill: var(--secondary-text-color); flex-shrink: 0; }
        .results-item-value { font-size: 2.5em; font-weight: 700; color: var(--accent-color); line-height: 1; }
        .results-item-text { font-size: 14px; color: var(--secondary-text-color); }
        .results-item-text strong { color: var(--text-color); }
        ul { padding-left: 20px; margin: 8px 0 0 0; }
        .disclaimer { text-align: center; margin-top: 24px; font-size: 12px; color: var(--secondary-text-color); }
    </style>
</head>
<body>

    <div class="card">
        <div class="tab-container">
            <button class="tab-button active" onclick="switchTab('score2')">SCORE2 Hesaplayıcı (Avrupa)</button>
            <button class="tab-button" onclick="switchTab('mesa')">MESA Hesaplayıcı (ABD)</button>
        </div>

        <div class="calculator-content">
            <!-- MESA FORMU -->
            <div id="mesa-calculator" class="hidden"> /* ... MESA Formu içeriği değişmedi ... */ </div>

            <!-- SCORE2 FORMU -->
            <div id="score2-calculator">
                <h1>SCORE2 Risk Hesaplayıcı (Kıbrıs)</h1>
                <form id="score2-risk-form">
                    <div class="form-grid">
                        <div class="form-group"><input type="number" id="score2-yas" class="form-input" required value="47"><label for="score2-yas" class="form-label">Yaş (40-69)</label></div>
                        <div class="form-group"><select id="score2-cinsiyet" class="form-select" required><option value="erkek" selected>Erkek</option><option value="kadin">Kadın</option></select><label for="score2-cinsiyet" class="form-label">Cinsiyet</label><span class="select-icon">&#9662;</span></div>
                        <div class="form-group"><input type="number" id="score2-total-chol" class="form-input" required value="180"><label for="score2-total-chol" class="form-label">Toplam Kolesterol (mg/dL)</label></div>
                        <div class="form-group"><input type="number" id="score2-hdl-chol" class="form-input" required value="55"><label for="score2-hdl-chol" class="form-label">HDL Kolesterol (mg/dL)</label></div>
                        <div class="form-group full-width"><input type="number" id="score2-sistolik" class="form-input" required value="120"><label for="score2-sistolik" class="form-label">Sistolik Kan Basıncı (mmHg)</label></div>
                        <div class="form-group full-width"><p class="radio-group-title">Sigara kullanıyor musunuz?</p><label class="radio-container"><input type="radio" name="score2-sigara" value="evet"><span class="radio-checkmark"></span><span class="radio-label">Evet</span></label><label class="radio-container"><input type="radio" name="score2-sigara" value="hayir" required checked><span class="radio-checkmark"></span><span class="radio-label">Hayır</span></label></div>
                    </div>
                    <button type="button" class="material-button" onclick="hesaplaScore2()">Riski Hesapla</button>
                </form>
            </div>

            <div id="sonuc-alani"></div>
            <p class="disclaimer">Bu araç, MESA (ABD) ve SCORE2 (Avrupa) risk modellerini kullanır. Sonuçlar bilgilendirme amaçlıdır ve tıbbi bir tavsiye yerine geçmez. Lütfen bir hekime danışınız.</p>
        </div>
    </div>
    
    <!-- İkonlar -->
    <div style="display:none"> <svg id="icon-warning" viewBox="0 0 24 24"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg> <svg id="icon-alarm" viewBox="0 0 24 24"><path d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9-4.03-9-9-9zm0 16c-3.86 0-7-3.14-7-7s3.14-7 7-7 7 3.14 7 7-3.14 7-7 7z"/></svg> <svg id="icon-person" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg> <svg id="icon-target" viewBox="0 0 24 24"><path d="M12 2C6.49 2 2 6.49 2 12s4.49 10 10 10 10-4.49 10-10S17.51 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5.5-2.5l1.41 1.41L12 13.41l4.09 4.09 1.41-1.41L13.41 12l4.09-4.09-1.41-1.41L12 10.59 7.91 6.5 6.5 7.91 10.59 12l-4.09 4.09z"/></svg> </div>

    <script>
        // --- GLOBAL HELPER FUNCTIONS ---
        function switchTab(tabName) { document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active')); document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active'); ['mesa-calculator', 'score2-calculator'].forEach(id => document.getElementById(id).classList.add('hidden')); document.getElementById(`${tabName}-calculator`).classList.remove('hidden'); document.getElementById('sonuc-alani').style.display = 'none'; }
        document.querySelectorAll('.material-button').forEach(button => { button.addEventListener('click', function(e) { const rect = e.target.getBoundingClientRect(), x = e.clientX - rect.left, y = e.clientY - rect.top; const ripple = document.createElement('span'); ripple.classList.add('ripple'); ripple.style.left = x + 'px'; ripple.style.top = y + 'px'; this.appendChild(ripple); setTimeout(() => ripple.remove(), 600); }); });
        
        // --- SCORE2 CALCULATOR (DOĞRU FORMÜL İLE) ---
        function hesaplaScore2() {
            const yas = parseInt(document.getElementById('score2-yas').value);
            const cinsiyet = document.getElementById('score2-cinsiyet').value;
            const sigara = document.querySelector('input[name="score2-sigara"]:checked')?.value;
            const sistolik_bp = parseInt(document.getElementById('score2-sistolik').value);
            const total_chol_mgdl = parseFloat(document.getElementById('score2-total-chol').value);
            const hdl_chol_mgdl = parseFloat(document.getElementById('score2-hdl-chol').value);
            
            if (!yas || !cinsiyet || !sigara || !sistolik_bp || !total_chol_mgdl || !hdl_chol_mgdl) { alert("Lütfen tüm alanları doldurunuz."); return; }

            const non_hdl_mgdl = total_chol_mgdl - hdl_chol_mgdl;
            const non_hdl_mmol = non_hdl_mgdl / 38.67;

            // --- DOĞRU KATSAYILAR VE FORMÜL (MODERATE RISK BÖLGESİ) ---
            // Kaynak: SCORE2 - European Heart Journal (2021), Supplementary Material, Table S7
            const coeffs = {
                erkek: {
                    p1: (age, ln_age, sbp, ln_sbp, smoke, non_hdl, ln_non_hdl) => 
                        0.44433 + (0.02844 * age) + (1.61803 * ln_age) - (0.33471 * ln_age * ln_age) - 
                        (0.01358 * age * smoke) - (0.00033 * age * sbp) - (0.00311 * age * ln_sbp) - 
                        (0.00004 * age * non_hdl) + (0.00003 * age * ln_non_hdl),
                    p2: (sbp, ln_sbp, smoke, non_hdl, ln_non_hdl) =>
                        (0.01770 * sbp) + (0.24495 * ln_sbp) + (0.50989 * smoke) + 
                        (0.00201 * non_hdl) + (0.23129 * ln_non_hdl),
                    s0: 0.938, mean_lp: 4.667
                },
                kadin: {
                    p1: (age, ln_age, sbp, ln_sbp, smoke, non_hdl, ln_non_hdl) =>
                        0.94015 + (0.04368 * age) + (0.83545 * ln_age) - (0.17721 * ln_age * ln_age) -
                        (0.01321 * age * smoke) - (0.00021 * age * sbp) - (0.00222 * age * ln_sbp) -
                        (0.00109 * age * non_hdl) + (0.00164 * age * ln_non_hdl),
                    p2: (sbp, ln_sbp, smoke, non_hdl, ln_non_hdl) =>
                        (0.00531 * sbp) + (0.20790 * ln_sbp) + (0.47353 * smoke) +
                        (0.02708 * non_hdl) + (0.13451 * ln_non_hdl),
                    s0: 0.963, mean_lp: 5.764
                }
            };

            const c = coeffs[cinsiyet];
            const is_smoker = (sigara === 'evet') ? 1 : 0;
            const ln_age = Math.log(yas);
            const ln_sbp = Math.log(sistolik_bp);
            const ln_non_hdl = Math.log(non_hdl_mmol);

            const p1 = c.p1(yas, ln_age, sistolik_bp, ln_sbp, is_smoker, non_hdl_mmol, ln_non_hdl);
            const p2 = c.p2(sistolik_bp, ln_sbp, is_smoker, non_hdl_mmol, ln_non_hdl);
            const lp = p1 + p2;
            
            const risk_yuzde = (1 - Math.pow(c.s0, Math.exp(lp - c.mean_lp))) * 100;
            
            const patient_data = {
                date: new Date().toLocaleDateString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric' }),
                age: yas, sex: cinsiyet, sbp: sistolik_bp, total_chol: total_chol_mgdl, hdl_chol: hdl_chol_mgdl,
                smoker: sigara === 'evet' ? 'Evet' : 'Hayır',
                risk: risk_yuzde,
                risk_age: calculateScore2RiskAge(risk_yuzde, cinsiyet),
                threshold: getScore2RiskThreshold(yas)
            };

            document.getElementById('sonuc-alani').innerHTML = buildResultsScore2(patient_data);
            document.getElementById('sonuc-alani').style.display = 'block';
        }

        function calculateScore2RiskAge(risk_percentage, cinsiyet) { /* ... Risk Yaşı hesabı değişmedi ... */ }
        function getScore2RiskThreshold(age) { if (age < 50) return 2.5; if (age >= 50 && age < 70) return 5.0; return 7.5; }

        function buildResultsScore2(data) {
            // Sonuç kartı oluşturucu, SVG ikonlarını kullanacak şekilde güncellendi
            return `
            <div class="patient-summary">
                <h3>Girdiğiniz Değerler</h3>
                <div class="summary-grid">
                    <div class="summary-item">Tarih: <strong>${data.date}</strong></div>
                    <div class="summary-item">Yaş: <strong>${data.age}</strong></div>
                    <div class="summary-item">Cinsiyet: <strong>${data.sex}</strong></div>
                    <div class="summary-item">Sigara: <strong>${data.smoker}</strong></div>
                    <div class="summary-item">Sistolik KB: <strong>${data.sbp} mmHg</strong></div>
                    <div class="summary-item">Toplam Kolesterol: <strong>${data.total_chol} mg/dL</strong></div>
                    <div class="summary-item">HDL Kolesterol: <strong>${data.hdl_chol} mg/dL</strong></div>
                </div>
            </div>
            <div class="results-card">
                 <h3>Sonuç ve Tavsiyeler</h3>
                 <div class="results-grid">
                    <div class="results-item"> <svg><use href="#icon-warning"/></svg> <div> <div class="results-item-text">10 yıllık ölümcül/ölümcül olmayan KVH riskiniz:</div> <div class="results-item-value">${data.risk.toFixed(1)}%</div> </div> </div>
                    <div class="results-item"> <svg><use href="#icon-alarm"/></svg> <div> <div class="results-item-text">Sizin yaşınızdaki birisi için kılavuzların yüksek risk olarak kabul ettiği eşik:</div> <div class="results-item-value">${data.threshold}%</div> </div> </div>
                    <div class="results-item"> <svg><use href="#icon-person"/></svg> <div> <div class="results-item-text"><strong>Risk Yaşınız:</strong> Risk faktörlerinizden dolayı, riskiniz sağlıklı bir <strong>${Math.round(data.risk_age)}</strong> yaşındaki bireyinkine benzer.</div> </div> </div>
                    <div class="results-item"> <svg><use href="#icon-target"/></svg> <div> <div class="results-item-text"><strong>Önleme Hedefleri:</strong> <ul> <li>Sigarayı bırakma ve yaşam tarzı optimizasyonu.</li> <li>Sistolik KB < 140, tolere edilirse 130 mmHg hedefi.</li> <li>Non-HDL-C < 131 mg/dL.</li> </ul> </div> </div> </div>
                 </div>
            </div>`;
        }
        
        // Başlangıçta SCORE2 sekmesini göster
        switchTab('score2');
    </script>
</body>
</html>
