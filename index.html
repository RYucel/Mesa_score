<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kıbrıs için MESA Risk & Koroner Yaş Hesaplayıcı</title>
    <!-- Google Fonts: Roboto -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1976D2; /* Material Blue 700 */
            --accent-color: #4CAF50; /* Material Green 500 */
            --accent-light-color: #E8F5E9;
            --text-color: #212121;
            --secondary-text-color: #757575;
            --divider-color: #BDBDBD;
            --background-color: #ECEFF1;
            --negative-color: #D32F2F; /* Material Red 700 */
            --positive-color: #0288D1; /* Material Light Blue 700 */
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color);
            margin: 0;
            padding: 24px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .card {
            background-color: #ffffff;
            padding: 24px 32px 32px 32px;
            border-radius: 8px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
            max-width: 650px;
            width: 100%;
            box-sizing: border-box;
        }
        
        h1 {
            color: var(--text-color);
            text-align: center;
            margin-top: 0;
            margin-bottom: 32px;
            font-weight: 500;
            font-size: 24px;
        }

        /* Form Stilleri */
        .form-group { position: relative; margin-bottom: 24px; }
        .form-input, .form-select { width: 100%; border: none; border-bottom: 1px solid var(--divider-color); padding: 12px 0 8px 0; font-size: 16px; background-color: transparent; position: relative; z-index: 1; }
        .form-select { -webkit-appearance: none; -moz-appearance: none; appearance: none; cursor: pointer; }
        .select-icon { position: absolute; right: 0; top: 12px; pointer-events: none; color: var(--secondary-text-color); z-index: 0; }
        .form-label { position: absolute; top: 12px; left: 0; font-size: 16px; color: var(--secondary-text-color); pointer-events: none; transition: 0.2s ease all; }
        .form-input:focus, .form-select:focus { outline: none; border-bottom-width: 2px; border-bottom-color: var(--primary-color); }
        .form-input:focus ~ .form-label, .form-input:valid ~ .form-label, .form-select:focus ~ .form-label, .form-select:valid ~ .form-label { top: -12px; font-size: 12px; color: var(--primary-color); }
        .radio-group-title { color: var(--secondary-text-color); font-size: 14px; margin-bottom: 12px; }
        .radio-container { display: inline-flex; align-items: center; margin-right: 24px; cursor: pointer; }
        .radio-container input { display: none; }
        .radio-checkmark { height: 20px; width: 20px; border: 2px solid var(--secondary-text-color); border-radius: 50%; display: inline-block; position: relative; margin-right: 8px; transition: border-color 0.3s; }
        .radio-checkmark:after { content: ''; position: absolute; display: none; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 10px; height: 10px; border-radius: 50%; background: var(--primary-color); }
        .radio-container input:checked ~ .radio-checkmark { border-color: var(--primary-color); }
        .radio-container input:checked ~ .radio-checkmark:after { display: block; }
        .radio-label { color: var(--text-color); }

        /* Buton Stilleri */
        .material-button { width: 100%; padding: 12px 24px; background-color: var(--primary-color); color: white; border: none; border-radius: 4px; font-size: 14px; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; cursor: pointer; transition: box-shadow 0.3s; position: relative; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); }
        .material-button:hover { box-shadow: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23); }
        .ripple { position: absolute; border-radius: 50%; transform: scale(0); animation: ripple-animation 0.6s linear; background-color: rgba(255, 255, 255, 0.7); }
        @keyframes ripple-animation { to { transform: scale(4); opacity: 0; } }

        /* Sonuç Alanı Stilleri */
        #sonuc-alani { margin-top: 32px; display: none; }
        .result-card { padding: 20px; background-color: var(--accent-light-color); border-radius: 4px; margin-bottom: 16px; }
        .result-card h3 { margin-top: 0; margin-bottom: 20px; text-align: center; font-weight: 500; color: var(--text-color); }
        .result-grid { display: grid; grid-template-columns: repeat(3, 1fr); text-align: center; gap: 16px; }
        .result-item-title { font-size: 14px; color: var(--secondary-text-color); margin-bottom: 8px; }
        .result-item-value { font-size: 28px; font-weight: 500; }
        .risk-value { color: var(--accent-color); }
        .age-value { color: var(--accent-color); }
        .diff-value-positive { color: var(--positive-color); }
        .diff-value-negative { color: var(--negative-color); }
        #coronary-age-info { font-size: 13px; color: var(--secondary-text-color); text-align: center; margin-top: 16px; }

        .disclaimer { text-align: center; margin-top: 24px; font-size: 12px; color: var(--secondary-text-color); }
    </style>
</head>
<body>

    <div class="card">
        <h1>Kıbrıs için Kalp Riski & Koroner Yaş Hesaplayıcı</h1>
        <form id="risk-form">
            <!-- Irk sorusu kaldırıldı -->
            <div class="form-group"><input type="number" id="yas" class="form-input" required><label for="yas" class="form-label">Yaş (45-84 arası)</label></div>
            <div class="form-group"><select id="cinsiyet" class="form-select" required><option value="" disabled selected></option><option value="erkek">Erkek</option><option value="kadin">Kadın</option></select><label for="cinsiyet" class="form-label">Cinsiyet</label><span class="select-icon">&#9662;</span></div>
            <div class="form-group"><input type="number" id="toplam_kolesterol" class="form-input" required><label for="toplam_kolesterol" class="form-label">Toplam Kolesterol (mg/dL)</label></div>
            <div class="form-group"><input type="number" id="hdl_kolesterol" class="form-input" required><label for="hdl_kolesterol" class="form-label">HDL Kolesterol (mg/dL)</label></div>
            <div class="form-group"><input type="number" id="sistolik_tansiyon" class="form-input" required><label for="sistolik_tansiyon" class="form-label">Sistolik Kan Basıncı (mmHg)</label></div>
            <div class="form-group"><p class="radio-group-title">Tansiyon ilacı kullanıyor musunuz?</p><label class="radio-container"><input type="radio" name="tansiyon_tedavisi" value="evet" required><span class="radio-checkmark"></span><span class="radio-label">Evet</span></label><label class="radio-container"><input type="radio" name="tansiyon_tedavisi" value="hayir"><span class="radio-checkmark"></span><span class="radio-label">Hayır</span></label></div>
            <div class="form-group"><p class="radio-group-title">Diyabetiniz var mı?</p><label class="radio-container"><input type="radio" name="diyabet" value="evet" required><span class="radio-checkmark"></span><span class="radio-label">Evet</span></label><label class="radio-container"><input type="radio" name="diyabet" value="hayir"><span class="radio-checkmark"></span><span class="radio-label">Hayır</span></label></div>
            <div class="form-group"><p class="radio-group-title">Sigara kullanıyor musunuz?</p><label class="radio-container"><input type="radio" name="sigara" value="evet" required><span class="radio-checkmark"></span><span class="radio-label">Evet</span></label><label class="radio-container"><input type="radio" name="sigara" value="hayir"><span class="radio-checkmark"></span><span class="radio-label">Hayır</span></label></div>
            <div class="form-group"><p class="radio-group-title">Ailenizde kalp krizi öyküsü var mı?</p><label class="radio-container"><input type="radio" name="aile_oykusu" value="evet" required><span class="radio-checkmark"></span><span class="radio-label">Evet</span></label><label class="radio-container"><input type="radio" name="aile_oykusu" value="hayir"><span class="radio-checkmark"></span><span class="radio-label">Hayır</span></label></div>
            <div class="form-group"><input type="number" id="kalsiyum_skoru" class="form-input"><label for="kalsiyum_skoru" class="form-label">Koroner Arter Kalsiyum (CAC) Skoru (İsteğe bağlı)</label></div>
            
            <button type="button" class="material-button" onclick="hesapla()">Riski & Koroner Yaşı Hesapla</button>
        </form>

        <div id="sonuc-alani">
            <!-- Sonuçlar buraya dinamik olarak eklenecek -->
        </div>

        <p class="disclaimer">
            Bu araç, ABD popülasyonu için geliştirilmiş MESA risk modelini kullanır. Sonuçlar bilgilendirme amaçlıdır ve tıbbi bir tavsiye yerine geçmez. Lütfen bir hekime danışınız.
        </p>
    </div>

    <script>
        // --- RIPPLE EFFECT FOR BUTTON ---
        document.querySelector('.material-button').addEventListener('click', function (e) { /* ... (Değişiklik yok) ... */ const rect = e.target.getBoundingClientRect(); const x = e.clientX - rect.left, y = e.clientY - rect.top; const ripple = document.createElement('span'); ripple.classList.add('ripple'); ripple.style.left = x + 'px'; ripple.style.top = y + 'px'; this.appendChild(ripple); setTimeout(() => ripple.remove(), 600); });

        // --- KORONER YAŞ HESAPLAMA FONKSİYONU ---
        function calculateCoronaryAge(risk_percentage, baseline_survival, coeff, constant) { /* ... (Değişiklik yok) ... */ if (risk_percentage >= 100) risk_percentage = 99.9; if (risk_percentage <= 0) risk_percentage = 0.1; const risk_decimal = risk_percentage / 100.0; const A = Math.log(Math.log(1 - risk_decimal) / Math.log(baseline_survival)); const coronaryAge = (A - constant) / coeff; return coronaryAge; }

        // --- ANA HESAPLAMA MANTIĞI ---
        function hesapla() {
            // 1. FORM VERİLERİNİ TOPLAMA
            const yas = parseInt(document.getElementById('yas').value);
            const cinsiyet = document.getElementById('cinsiyet').value;
            const irk = 'beyaz'; // Irk sabit olarak ayarlandı
            const toplam_kolesterol = parseInt(document.getElementById('toplam_kolesterol').value);
            const hdl_kolesterol = parseInt(document.getElementById('hdl_kolesterol').value);
            const sistolik_tansiyon = parseInt(document.getElementById('sistolik_tansiyon').value);
            const tansiyon_tedavisi = document.querySelector('input[name="tansiyon_tedavisi"]:checked')?.value;
            const diyabet = document.querySelector('input[name="diyabet"]:checked')?.value;
            const sigara = document.querySelector('input[name="sigara"]:checked')?.value;
            const aile_oykusu = document.querySelector('input[name="aile_oykusu"]:checked')?.value;
            const kalsiyum_skoru_input = document.getElementById('kalsiyum_skoru').value;
            const kalsiyum_skoru = kalsiyum_skoru_input ? parseInt(kalsiyum_skoru_input) : null;

            if (!yas || !cinsiyet || !toplam_kolesterol || !hdl_kolesterol || !sistolik_tansiyon || !tansiyon_tedavisi || !diyabet || !sigara || !aile_oykusu) {
                alert("Lütfen kalsiyum skoru dışındaki tüm alanları doldurunuz.");
                return;
            }

            // 2. MESA SKORU HESAPLAMA MANTIĞI
            const katsayilar = { 'yas': 0.0455, 'cinsiyet_erkek': 0.7496, 'irk_cinli': -0.5055, 'irk_siyahi': -0.2111, 'irk_hispanik': -0.1900, 'toplam_kolesterol': 0.0053, 'hdl_kolesterol': -0.0140, 'sistolik_tansiyon': 0.0085, 'tansiyon_tedavisi_evet': 0.3381, 'diyabet_evet': 0.5168, 'sigara_evet': 0.4732, 'aile_oykusu_evet': 0.4522 };
            const katsayilar_cac = { 'yas': 0.0172, 'cinsiyet_erkek': 0.4079, 'irk_cinli': -0.3475, 'irk_siyahi': 0.0353, 'irk_hispanik': -0.0222, 'toplam_kolesterol': 0.0043, 'hdl_kolesterol': -0.0114, 'sistolik_tansiyon': 0.0066, 'tansiyon_tedavisi_evet': 0.2278, 'diyabet_evet': 0.3892, 'sigara_evet': 0.3717, 'aile_oykusu_evet': 0.3239, 'ln_cac_plus_1': 0.2743 };

            function getBetaToplami(veri, katsayi_listesi) { /* ... (Değişiklik yok, 'irk' kontrolü yine de çalışır) ... */
                let beta_toplami = 0; beta_toplami += veri.yas * katsayi_listesi.yas; if (veri.cinsiyet === 'erkek') beta_toplami += katsayi_listesi.cinsiyet_erkek; if (veri.irk === 'cinli') beta_toplami += katsayi_listesi.irk_cinli; if (veri.irk === 'siyahi') beta_toplami += katsayi_listesi.irk_siyahi; if (veri.irk === 'hispanik') beta_toplami += katsayi_listesi.irk_hispanik; beta_toplami += veri.toplam_kolesterol * katsayi_listesi.toplam_kolesterol; beta_toplami += veri.hdl_kolesterol * katsayi_listesi.hdl_kolesterol; beta_toplami += veri.sistolik_tansiyon * katsayi_listesi.sistolik_tansiyon; if (veri.tansiyon_tedavisi === 'evet') beta_toplami += katsayi_listesi.tansiyon_tedavisi_evet; if (veri.diyabet === 'evet') beta_toplami += katsayi_listesi.diyabet_evet; if (veri.sigara === 'evet') beta_toplami += katsayi_listesi.sigara_evet; if (veri.aile_oykusu === 'evet') beta_toplami += katsayi_listesi.aile_oykusu_evet; if (veri.kalsiyum_skoru !== null && katsayi_listesi.ln_cac_plus_1) { beta_toplami += Math.log(veri.kalsiyum_skoru + 1) * katsayi_listesi.ln_cac_plus_1; } return beta_toplami;
            }
            
            const hasta_verisi = { yas, cinsiyet, irk, toplam_kolesterol, hdl_kolesterol, sistolik_tansiyon, tansiyon_tedavisi, diyabet, sigara, aile_oykusu, kalsiyum_skoru };
            
            const beta_toplami_temel = getBetaToplami(hasta_verisi, katsayilar);
            const risk_temel = (1 - Math.pow(0.99963, Math.exp(beta_toplami_temel))) * 100;
            const koroner_yas_temel = calculateCoronaryAge(risk_temel, 0.99963, 0.0455, 2.45);
            const fark_temel = Math.round(koroner_yas_temel) - yas;

            let sonucHTML = '';
            if (kalsiyum_skoru !== null) {
                const beta_toplami_cac = getBetaToplami(hasta_verisi, katsayilar_cac);
                const risk_cac = (1 - Math.pow(0.99833, Math.exp(beta_toplami_cac))) * 100;
                const koroner_yas_cac = calculateCoronaryAge(risk_cac, 0.99963, 0.0455, 2.45);
                const fark_cac = Math.round(koroner_yas_cac) - yas;
                sonucHTML += buildResultCard("Kalsiyum Skoru Dahil Edildiğinde", risk_cac, koroner_yas_cac, fark_cac);
            }
            
            sonucHTML += buildResultCard("Geleneksel Risk Faktörlerine Göre", risk_temel, koroner_yas_temel, fark_temel);
            sonucHTML += `<p id="coronary-age-info"><b>Koroner Yaş:</b> Sizinle aynı kalp hastalığı riskine sahip olan sağlıklı bir bireyin ortalama yaşıdır.</p>`;

            const sonucAlani = document.getElementById('sonuc-alani');
            sonucAlani.innerHTML = sonucHTML;
            sonucAlani.style.display = 'block';
        }

        function buildResultCard(title, risk, coronaryAge, difference) { /* ... (Değişiklik yok) ... */ const diff_class = difference >= 0 ? 'diff-value-negative' : 'diff-value-positive'; const diff_sign = difference > 0 ? '+' : ''; return ` <div class="result-card"> <h3>${title}</h3> <div class="result-grid"> <div> <div class="result-item-title">10 Yıllık KKH Riski</div> <div class="result-item-value risk-value">${risk.toFixed(1)}%</div> </div> <div> <div class="result-item-title">Koroner Yaş</div> <div class="result-item-value age-value">${Math.round(coronaryAge)}</div> </div> <div> <div class="result-item-title">Kronolojik Yaştan Fark</div> <div class="result-item-value ${diff_class}">${diff_sign}${difference}</div> </div> </div> </div>`; }
    </script>

</body>
</html>
